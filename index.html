<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ina-vicaL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --accent: #e11d48;
            --border: #e2e8f0;
            --font-main: 'Inter', 'Noto Sans JP', sans-serif;
        }
        /* Layout Structure */
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-main);
            margin: 0;
            display: flex;
            justify-content: flex-end;
            /* Align everything to the right edge */
            min-height: 100vh;
            overflow-x: hidden;
        }
        .app-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            padding: 1rem;
            gap: 1.5rem;
            align-items: flex-start;
            justify-content: flex-end;
            /* Content pushed to right */
        }
        .content-wrapper {
            flex: 1;
            min-width: 0;
            max-width: 850px;
            /* Limit form width */
        }
        /* Sidebar Styling - Slim & Vertical */
        .results-sidebar {
            position: sticky;
            top: 1rem;
            width: 130px;
            /* Slightly more than 120 for padding safety */
            flex-shrink: 0;
            align-self: flex-start;
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            color: var(--text-main);
            z-index: 10;
        }
        .results-sidebar h2 {
            margin: 0 0 0.5rem 0;
            font-size: 0.8rem;
            text-align: center;
            opacity: 0.8;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-copy {
            position: absolute;
            top: -2px;
            right: 0;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .btn-copy:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .sidebar-result {
            background: #f8fafc;
            border-radius: 8px;
            padding: 0.4rem;
            margin-bottom: 0.5rem;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .sidebar-result:last-child {
            margin-bottom: 0;
        }
        .sidebar-result h3 {
            margin: 0 0 0.2rem 0;
            font-size: 0.65rem;
            font-weight: 700;
            line-height: 1.2;
            color: var(--text-muted);
        }
        .sidebar-result .subtitle {
            font-size: 0.55rem;
            font-weight: 400;
            display: block;
            opacity: 0.7;
        }
        .sidebar-result .result-value {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary);
            margin-top: 0.1rem;
        }
        /* Specific Sidebar Box Styles */
        .sidebar-result.calc-stats .stats-column {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            width: 100%;
        }
        .stat-mini {
            display: flex;
            flex-direction: column;
            align-items: center;
            border-top: 1px solid #edf2f7;
            padding-top: 0.2rem;
            margin-top: 0.2rem;
        }
        .stat-mini:first-child {
            border-top: none;
            margin-top: 0;
        }
        .mini-label {
            font-size: 0.5rem;
            text-transform: uppercase;
            opacity: 0.6;
        }
        .sidebar-result.calc-stats .result-value {
            font-size: 0.95rem;
        }
        .sidebar-result.tech-power {
            background: #eff6ff;
            border-color: #bfdbfe;
        }
        .sidebar-result.total-box {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border: none;
            color: white;
        }
        .sidebar-result.total-box h3,
        .sidebar-result.total-box .subtitle,
        .sidebar-result.total-box .result-value {
            color: white;
        }
        .sidebar-result.total-box .result-value {
            font-size: 1.3rem;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        @media (max-width: 768px) {
            body {
                justify-content: center;
                padding-bottom: 2rem;
            }
            .app-container {
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
                gap: 1rem;
                padding: 0.5rem;
            }
            .content-wrapper {
                width: 100%;
                max-width: none;
            }
            /* Mobile Sidebar: Horizontal Grid (Sticky Header Style) */
            .results-sidebar {
                position: sticky;
                top: 0;
                z-index: 1000;
                background: #ffffff;
                width: calc(100% + 1rem);
                margin: -0.5rem -0.5rem 1rem -0.5rem;
                padding: 0.3rem 0.5rem;
                /* Ultra compact */
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0.3rem;
                box-sizing: border-box;
                border: none;
                border-bottom: 2px solid var(--primary);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                border-radius: 0 0 12px 12px;
            }
            /* Hide the Header Container (H2 + Copy Button Wrapper) from flow */
            .results-sidebar>div:first-child {
                position: absolute;
                width: 0;
                height: 0;
                top: 0;
                right: 0;
                z-index: 2000;
            }
            /* Hide text */
            .results-sidebar h2 {
                display: none;
            }
            /* Float copy button */
            .btn-copy {
                position: absolute;
                top: 0.4rem;
                right: 0.5rem;
                width: 24px;
                height: 24px;
                background: rgba(255, 255, 255, 0.9);
                border-radius: 50%;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0.8;
            }
            .btn-copy:active {
                transform: scale(0.9);
            }
            .sidebar-result {
                margin-bottom: 0;
                padding: 0.2rem;
            }
            /* Mobile Input Stacking */
            .input-row,
            .preset-row {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            .equip-grid {
                grid-template-columns: 1fr;
                /* Stack equipment vertically */
                gap: 0.75rem;
            }
            .mode-selection {
                flex-direction: column;
                gap: 0.75rem;
            }
            .btn-preset {
                width: 100%;
                /* Full width buttons */
                text-align: center;
            }
            .role-label {
                width: 100%;
                text-align: center;
                margin-bottom: 0.25rem;
            }
        }
        /* Utility */
        .hidden {
            display: none !important;
        }
        #presetContainer.hidden,
        #manualContainer.hidden {
            display: none !important;
        }
        /* Preset Buttons */
        .btn-preset {
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            flex: 1;
        }
        .btn-preset:hover {
            border-color: var(--primary);
            background: #f1f5f9;
        }
        .btn-preset.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary-hover);
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }
        /* Tabs (Mode Selection) */
        .mode-tabs {
            display: flex;
            background: #e2e8f0;
            padding: 0.25rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            gap: 0.25rem;
        }
        .tab-btn {
            flex: 1;
            padding: 0.6rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .tab-btn.active {
            background: #ffffff;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        /* Segmented Controls (Replacing Dropdowns) */
        .segmented-control {
            display: flex;
            flex-wrap: wrap;
            /* Ensure buttons wrap on small screens */
            background: #f1f5f9;
            padding: 0.2rem;
            border-radius: 6px;
            gap: 0.2rem;
            border: 1px solid var(--border);
        }
        .segment-btn {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.4rem 0.2rem;
            font-size: 0.8rem;
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            /* Prevent text wrapping if possible */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .segment-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            color: var(--text-main);
        }
        .segment-btn.active {
            background: #ffffff;
            color: var(--primary);
            font-weight: 700;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        .role-label {
            font-weight: 800;
            font-size: 0.8rem;
            width: 30px;
            text-align: center;
            color: var(--text-muted);
        }
        .role-label.fw {
            color: #ef4444;
        }
        .role-label.mf {
            color: #22c55e;
        }
        .role-label.df {
            color: #3b82f6;
        }
        .role-label.gk {
            color: #eab308;
        }
        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 12px 24px;
            position: fixed;
            z-index: 9999;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%) translateY(20px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            font-size: 0.9rem;
            font-weight: 600;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        /* Passive Grid */
        .passive-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        @media (min-width: 600px) {
            .passive-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .p-item {
            display: flex;
            flex-direction: column;
        }
        .p-item label {
            margin-bottom: 0.2rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        .p-item input {
            width: 100%;
            padding: 0.3rem;
            border: 1px solid var(--border);
            border-radius: 4px;
            background: var(--bg-input);
            color: var(--text-main);
            font-size: 0.9rem;
        }
        .input-with-btn {
            display: flex;
            gap: 0.25rem;
        }
        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            background: #f1f5f9;
            border: 1px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
        }
        .label-small {
            display: block;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        .input-section h2 {
            margin-top: 0;
            font-size: 1.1rem;
            color: var(--primary);
            border-bottom: 2px solid #eef2ff;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .separator {
            border: 0;
            border-top: 1px solid var(--border);
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Results Sidebar (Fixed Left) -->
        <aside class="results-sidebar">
            <div class="sidebar-header">
                <h2>Results</h2>
                <button class="btn-copy" onclick="copyResults()" title="Copy Results">üìã</button>
            </div>
            <div class="sidebar-result calc-stats">
                <h3>Effective Stats<br><span class="subtitle">(Ë®àÁÆóÂÄ§)</span></h3>
                <div class="stats-column">
                    <div class="stat-mini">
                        <span class="mini-label">Kick</span>
                        <div class="result-value" id="calcKick">0</div>
                    </div>
                    <div class="stat-mini">
                        <span class="mini-label">Ctrl</span>
                        <div class="result-value" id="calcControl">0</div>
                    </div>
                </div>
            </div>
            <div class="sidebar-result">
                <h3>Character Power<br><span class="subtitle">(„Ç≠„É£„É©„Ç∑„É•„Éº„ÉàÂäõ)</span></h3>
                <div class="result-value" id="characterPower">0</div>
            </div>
            <div class="sidebar-result tech-power">
                <h3>Tech Power<br><span class="subtitle">(ÊäÄÂ®ÅÂäõ)</span></h3>
                <div class="result-value" id="techniquePowerDisplay">0</div>
            </div>
            <div class="sidebar-result total-box">
                <h3>Total AT<br><span class="subtitle">(„Éà„Éº„Çø„É´AT)</span></h3>
                <div class="result-value" id="totalAt">0</div>
            </div>
        </aside>
        <!-- Main Content (Right Aligned) -->
        <div class="content-wrapper">
            <header>
                <h1>‚öΩ ina-vicaL</h1>
            </header>
            <main class="main-content">
                <!-- Mode Selection (Tabs) -->
                <div class="mode-tabs">
                    <button class="tab-btn active" onclick="setMode('preset')" id="tab-preset">Preset Mode
                        („Éó„É™„Çª„ÉÉ„Éà)</button>
                    <button class="tab-btn" onclick="setMode('manual')" id="tab-manual">Direct Input (Áõ¥Êé•ÂÖ•Âäõ)</button>
                </div>
                <!-- PRESET MODE -->
                <div id="presetContainer" class="mode-container">
                    <!-- NEW: Category Selector (Replacing Rarity) -->
                    <div class="input-group" style="margin-bottom: 1rem;">
                        <label for="presetCategory" class="label-small">Rarity („É¨„Ç¢„É™„ÉÜ„Ç£):</label>
                        <select id="presetCategory" style="display:none;" onchange="togglePresetCategory()">
                            <option value="standard">Standard (Legendary)</option>
                            <option value="basara">BASARA (Future)</option>
                            <option value="hero">HERO (Future)</option>
                        </select>
                        <div class="segmented-control">
                            <button class="segment-btn active"
                                onclick="setSegment('presetCategory', 'standard', this); togglePresetCategory();">Standard</button>
                            <button class="segment-btn"
                                onclick="setSegment('presetCategory', 'basara', this); togglePresetCategory();">BASARA</button>
                            <button class="segment-btn"
                                onclick="setSegment('presetCategory', 'hero', this); togglePresetCategory();">HERO</button>
                        </div>
                    </div>
                    <!-- STANDARD PRESETS -->
                    <div id="presets-standard" class="preset-group">
                        <span class="label-small">Tribe Selection (ÊóèÈÅ∏Êäû):</span>
                        <div class="preset-row">
                            <span class="role-label fw">FW</span>
                            <button class="btn-preset" onclick="setPreset(121, 115, this)">FW‚ë† Ë±™ÁÇéÂØ∫Âûã (121/115)</button>
                            <button class="btn-preset" onclick="setPreset(114, 112, this)">FW‚ë° „Éè„É´Âûã (114/112)</button>
                            <button class="btn-preset" onclick="setPreset(117, 112, this)">FW‚ë¢ ÊüìÂ≤°Âûã (117/112)</button>
                        </div>
                        <div class="preset-row">
                            <span class="role-label mf">MF</span>
                            <button class="btn-preset" onclick="setPreset(104, 112, this)">MF‚ë† È¨ºÈÅìÂûã (104/112)</button>
                            <button class="btn-preset" onclick="setPreset(100, 115, this)">MF‚ë° Â§©È¶¨Âûã (100/115)</button>
                            <button class="btn-preset" onclick="setPreset(97, 112, this)">MF‚ë¢ Â∞ëÊûóÂØ∫DÂûã (97/112)</button>
                        </div>
                        <div class="preset-row">
                            <span class="role-label df">DF</span>
                            <button class="btn-preset" onclick="setPreset(90, 94, this)">DF‚ë† È¢®‰∏∏Âûã (90/94)</button>
                            <button class="btn-preset" onclick="setPreset(83, 86, this)">DF‚ë° „ÉÜ„É¨„ÇπÂûã (83/86)</button>
                        </div>
                        <div class="preset-row">
                            <span class="role-label gk">GK</span>
                            <button class="btn-preset" onclick="setPreset(90, 97, this)">GK‚ë† ÂÜÜÂ†ÇÂûã (90/97)</button>
                            <button class="btn-preset" onclick="setPreset(86, 94, this)">GK‚ë° „Éá„Ç∂„Éº„É†Âûã (86/94)</button>
                        </div>
                    </div>
                    <!-- BASARA PRESETS -->
                    <div id="presets-basara" class="preset-group hidden">
                        <div class="help-text"
                            style="padding: 1rem; text-align: center; border: 1px dashed var(--border);">
                            BASARA Presets coming soon...
                        </div>
                    </div>
                    <!-- HERO PRESETS -->
                    <div id="presets-hero" class="preset-group hidden">
                        <div class="help-text"
                            style="padding: 1rem; text-align: center; border: 1px dashed var(--border);">
                            HERO Presets coming soon...
                        </div>
                    </div>
                    <hr class="separator">
                    <div class="preset-components">
                        <div class="stats-container">
                            <div class="stat-row">
                                <div class="stat-bean">
                                    <label for="kickBean">Kick Beans (+0~82)</label>
                                    <div class="input-with-btn">
                                        <input type="number" id="kickBean" value="82" min="0" max="82">
                                        <button class="btn-small" onclick="setMaxBeans('kick')">Max</button>
                                        <button class="btn-small btn-clear"
                                            onclick="setClearBeans('kick')">Clear</button>
                                    </div>
                                </div>
                                <div class="stat-bean">
                                    <label for="controlBean">Ctrl Beans (+0~82)</label>
                                    <div class="input-with-btn">
                                        <input type="number" id="controlBean" value="82" min="0" max="82">
                                        <button class="btn-small" onclick="setMaxBeans('control')">Max</button>
                                        <button class="btn-small btn-clear"
                                            onclick="setClearBeans('control')">Clear</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="separator">
                        <div class="stat-extras">
                            <span class="label-small">Equipment (Ë£ÖÂÇô)</span>
                            <div class="equip-grid">
                                <div class="input-group">
                                    <label>Shoes</label>
                                    <select id="equipBoots" style="display:none;">
                                        <option value="0,0" selected>„Å™„Åó</option>
                                        <option value="35,35">„Çπ„Éë„Ç§„ÇØ„É¢„É≥„Çπ„Çø„Éº</option>
                                        <option value="31,29">„ÉÄ„Éº„ÇØ„Ç®„É≥„Éö„É©„Éº</option>
                                        <option value="0,30">„Ç®„É≥„Ç∑„Çß„É≥„ÉàD</option>
                                    </select>
                                    <div class="segmented-control" style="flex-wrap: wrap;">
                                        <button class="segment-btn active"
                                            onclick="setSegment('equipBoots', '0,0', this)">„Å™„Åó</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBoots', '35,35', this)">„Çπ„Éë„Ç§„ÇØ„É¢„É≥„Çπ„Çø„Éº
                                            (+35/+35)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBoots', '31,29', this)">„ÉÄ„Éº„ÇØ„Ç®„É≥„Éö„É©„Éº
                                            (+31/+29)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBoots', '0,30', this)">„Ç®„É≥„Ç∑„Çß„É≥„ÉàD (+0/+30)</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Bracelet</label>
                                    <select id="equipBracelet" style="display:none;">
                                        <option value="0,0" selected>„Å™„Åó</option>
                                        <option value="30,29">Ê∑±Ê∑µ„ÅÆ„Éü„Çµ„É≥„Ç¨</option>
                                        <option value="26,0">ÈáéÊúõ„ÅÆ„Éê„É≥„Ç∞„É´</option>
                                        <option value="0,26">ÁÑ°Èôê„ÅÆ„Éê„É≥„Ç∞„É´</option>
                                    </select>
                                    <div class="segmented-control" style="flex-wrap: wrap;">
                                        <button class="segment-btn active"
                                            onclick="setSegment('equipBracelet', '0,0', this)">„Å™„Åó</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBracelet', '30,29', this)">Ê∑±Ê∑µ„ÅÆ„Éü„Çµ„É≥„Ç¨
                                            (+30/+29)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBracelet', '26,0', this)">ÈáéÊúõ„ÅÆ„Éê„É≥„Ç∞„É´
                                            (+26/+0)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipBracelet', '0,26', this)">ÁÑ°Èôê„ÅÆ„Éê„É≥„Ç∞„É´
                                            (+0/+26)</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Pendant</label>
                                    <select id="equipPendant" style="display:none;">
                                        <option value="0,0" selected>„Å™„Åó</option>
                                        <option value="30,40">ÁéãËÄÖ„ÅÆ„Éû„Éï„É©„Éº</option>
                                        <option value="29,29">„Ç®„Ç§„É™„Ç¢„Çπ„Éà„Éº„É≥</option>
                                        <option value="20,0">„Éó„É™„É≥„Çª„Çπ„Éû„É≥„Éà</option>
                                    </select>
                                    <div class="segmented-control" style="flex-wrap: wrap;">
                                        <button class="segment-btn active"
                                            onclick="setSegment('equipPendant', '0,0', this)">„Å™„Åó</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipPendant', '30,40', this)">ÁéãËÄÖ„ÅÆ„Éû„Éï„É©„Éº
                                            (+30/+40)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipPendant', '29,29', this)">„Ç®„Ç§„É™„Ç¢„Çπ„Éà„Éº„É≥
                                            (+29/+29)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipPendant', '20,0', this)">„Éó„É™„É≥„Çª„Çπ„Éû„É≥„Éà
                                            (+20/+0)</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Special</label>
                                    <select id="equipSpecial" style="display:none;">
                                        <option value="0,0" selected>„Å™„Åó</option>
                                        <option value="30,0">„Éô„Ç¨„Çµ„Çπ„ÅÆ„Ç∑„Éº„É´</option>
                                        <option value="0,28">È¨ºÈÅì„ÅÆ„Ç¥„Éº„Ç∞„É´</option>
                                        <option value="23,22">„Ç™„É°„Ç¨„É™„É≥„Ç∞</option>
                                    </select>
                                    <div class="segmented-control" style="flex-wrap: wrap;">
                                        <button class="segment-btn active"
                                            onclick="setSegment('equipSpecial', '0,0', this)">„Å™„Åó</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipSpecial', '30,0', this)">„Éô„Ç¨„Çµ„Çπ„ÅÆ„Ç∑„Éº„É´
                                            (+30/+0)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipSpecial', '0,28', this)">È¨ºÈÅì„ÅÆ„Ç¥„Éº„Ç∞„É´ (+0/+28)</button>
                                        <button class="segment-btn"
                                            onclick="setSegment('equipSpecial', '23,22', this)">„Ç™„É°„Ç¨„É™„É≥„Ç∞
                                            (+23/+22)</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- MANUAL MODE -->
                <div id="manualContainer" class="mode-container hidden">
                    <h3>Direct Input (Áõ¥Êé•ÂÖ•Âäõ)</h3>
                    <p class="help-text">Enter total stats directly. Ignores Rarity/Beans/Equip.</p>
                    <div class="stats-container">
                        <div class="stat-row">
                            <div class="stat-main">
                                <label for="kickManual"><span class="icon">üëü</span> Total Kick</label>
                                <input type="number" id="kickManual" placeholder="Total" value="0">
                            </div>
                        </div>
                        <div class="stat-row">
                            <div class="stat-main">
                                <label for="controlManual"><span class="icon">üéØ</span> Total Control</label>
                                <input type="number" id="controlManual" placeholder="Total" value="0">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Common Matchup Section -->
                <section class="card input-section">
                    <h2>Matchup (Áõ∏ÊÄß)</h2>
                    <div class="input-group full-width">
                        <label>Character Matchup („Ç≠„É£„É©Áõ∏ÊÄß)</label>
                        <select id="charMatchup" style="display:none;">
                            <option value="1.0" selected>Normal</option>
                            <option value="1.2">Advantage</option>
                            <option value="0.8">Disadvantage</option>
                        </select>
                        <div class="segmented-control">
                            <button class="segment-btn" onclick="setSegment('charMatchup', '0.8', this)">‰∏çÂà©
                                (0.8)</button>
                            <button class="segment-btn active" onclick="setSegment('charMatchup', '1.0', this)">Á≠âÂÄç
                                (1.0)</button>
                            <button class="segment-btn" id="btnCharAdv"
                                onclick="setSegment('charMatchup', '1.2', this)">ÊúâÂà© (1.2)</button>
                        </div>
                    </div>
                </section>
                <section class="card input-section">
                    <h2>Technique (ÊäÄ)</h2>
                    <div class="input-group">
                        <label>Base Power (Âü∫Êú¨Â®ÅÂäõ)</label>
                        <select id="basePower" style="display:none;">
                            <option value="30" selected>30</option>
                            <option value="50">50</option>
                            <option value="60">60</option>
                            <option value="70">70</option>
                            <option value="85">85</option>
                            <option value="100">100</option>
                        </select>
                        <div class="segmented-control" style="flex-wrap: wrap;">
                            <button class="segment-btn active" onclick="setSegment('basePower', '30', this)">30</button>
                            <button class="segment-btn" onclick="setSegment('basePower', '50', this)">50</button>
                            <button class="segment-btn" onclick="setSegment('basePower', '60', this)">60</button>
                            <button class="segment-btn" onclick="setSegment('basePower', '70', this)">70</button>
                            <button class="segment-btn" onclick="setSegment('basePower', '85', this)">85</button>
                            <button class="segment-btn" onclick="setSegment('basePower', '100', this)">100</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Evolution (ÈÄ≤Âåñ)</label>
                        <select id="evolution" style="display:none;">
                            <option value="1" selected>Base</option>
                            <option value="2">V2</option>
                            <option value="3">V3</option>
                            <option value="4">V4</option>
                            <option value="5">A/GX</option>
                            <option value="6">GO</option>
                        </select>
                        <div class="segmented-control">
                            <button class="segment-btn active"
                                onclick="setSegment('evolution', '1', this)">Base</button>
                            <button class="segment-btn" onclick="setSegment('evolution', '2', this)">V2</button>
                            <button class="segment-btn" onclick="setSegment('evolution', '3', this)">V3</button>
                            <button class="segment-btn" onclick="setSegment('evolution', '4', this)">V4</button>
                            <button class="segment-btn" onclick="setSegment('evolution', '5', this)">GX</button>
                            <button class="segment-btn" onclick="setSegment('evolution', '6', this)">GO</button>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Tech Matchup (ÊäÄÁõ∏ÊÄß)</label>
                        <select id="techMatchup" style="display:none;">
                            <option value="1.0" selected>Normal</option>
                            <option value="1.2">Advantage</option>
                            <option value="0.8">Disadvantage</option>
                        </select>
                        <div class="segmented-control">
                            <button class="segment-btn" onclick="setSegment('techMatchup', '0.8', this)">‰∏çÂà©
                                (0.8)</button>
                            <button class="segment-btn active" onclick="setSegment('techMatchup', '1.0', this)">Á≠âÂÄç
                                (1.0)</button>
                            <button class="segment-btn" id="btnTechAdv"
                                onclick="setSegment('techMatchup', '1.2', this)">ÊúâÂà©
                                (1.2)</button>
                        </div>
                    </div>
                </section>
                <section class="card input-section">
                    <h2>Bonuses</h2>
                    <div class="input-group">
                        <!-- Super Dimensional Moves -->
                        <div class="input-group">
                            <label>Super Dimensional Moves (Ë∂ÖÊ¨°ÂÖÉÊäÄ)</label>
                            <div class="segmented-control" id="superMoveControl"
                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.3rem;">
                                <button class="segment-btn active" onclick="setSuperMove('none', this)">„Å™„Åó</button>
                                <button class="segment-btn" onclick="setSuperMove('od', this)">„Ç™„Éº„Éê„Éº„Éâ„É©„Ç§„Éñ (+50%)</button>
                                <button class="segment-btn" onclick="setSuperMove('keshin', this)">ÂåñË∫´ (+40%)</button>
                                <button class="segment-btn" onclick="setSuperMove('armed', this)">„Ç¢„Éº„É†„Éâ
                                    (+20%/ÊäÄ1.3ÂÄç)</button>
                                <button class="segment-btn" onclick="setSuperMove('accel', this)">„Ç®„É¨„É°„É≥„Éà„Ç¢„ÇØ„Çª„É´
                                    (+30%)</button>
                                <button class="segment-btn" onclick="setSuperMove('boost30', this)">Boost‰ªñ
                                    (+30%)</button>
                            </div>
                        </div>
                        <!-- Manual Other -->
                        <div class="input-group">
                            <label for="multiplier">Other („Åù„ÅÆ‰ªñË£úÊ≠£)</label>
                            <div style="display:flex; gap:0.3rem; align-items:center; flex-wrap:wrap;">
                                <input type="number" id="multiplier" placeholder="0" value="0"
                                    style="flex:1; min-width:60px;" oninput="handleManualInput(this.value)">
                                <button class="btn-small" onclick="addManualBonus(10)">+10</button>
                                <button class="btn-small" onclick="addManualBonus(20)">+20</button>
                                <button class="btn-small" onclick="addManualBonus(30)">+30</button>
                                <button class="btn-small" onclick="clearBonuses()">Clr</button>
                                <button class="btn-small" id="btnTogglePassive"
                                    style="background:#f1f5f9; border:1px solid #cbd5e1; color:#333;"
                                    onclick="togglePassives()">Passives‚ñº</button>
                            </div>
                        </div>
                        <hr class="separator">
                        <!-- Passives Grid -->
                        <div class="input-group" id="passiveContainer" style="display:none;">
                            <div class="passive-grid">
                                <div class="p-item"><label>Ê≠£Áæ© (Justice)</label><input type="number" id="p_justice"
                                        placeholder="0"></div>
                                <div class="p-item"><label>„Ç´„Ç¶„É≥„Çø„Éº (Counter)</label><input type="number" id="p_counter"
                                        placeholder="0"></div>
                                <div class="p-item"><label>„ÉÜ„É≥„Ç∑„Éß„É≥ (Tension)</label><input type="number" id="p_tension"
                                        placeholder="0"></div>
                                <div class="p-item"><label>„Ç≠„Ç∫„Éä (Kizuna)</label><input type="number" id="p_kizuna"
                                        placeholder="0"></div>
                                <div class="p-item"><label>ÂêåÂ±ûÊÄß„Ç∑„É•„Éº„Éà (Team Same)</label><input type="number"
                                        id="p_team_same" placeholder="0"></div>
                                <div class="p-item"><label>Áï∞Â±ûÊÄß„Ç∑„É•„Éº„Éà (Team Diff)</label><input type="number"
                                        id="p_team_diff" placeholder="0"></div>
                                <div class="p-item"><label>Âêå„Éù„Ç∏„Ç∑„É•„Éº„Éà (Team Pos)</label><input type="number"
                                        id="p_team_pos" placeholder="0"></div>
                                <div class="p-item"><label>Âë®Âõ≤„Ç∑„É•„Éº„Éà (Team Surr)</label><input type="number"
                                        id="p_team_surround" placeholder="0"></div>
                                <div class="p-item"><label>ÂâçÂçäÊà¶ (1st Half)</label><input type="number" id="p_half_1"
                                        placeholder="0"></div>
                                <div class="p-item"><label>ÂæåÂçäÊà¶ (2nd Half)</label><input type="number" id="p_half_2"
                                        placeholder="0"></div>
                                <div class="p-item"><label>ÊïµÈô£ (Enemy Terr)</label><input type="number" id="p_self_enemy"
                                        placeholder="0"></div>
                                <div class="p-item"><label>Âë®Âõ≤ÂêåÂ±ûÊÄß (Nearby Same)</label><input type="number"
                                        id="p_self_same" placeholder="0"></div>
                                <div class="p-item"><label>Âë®Âõ≤Áï∞Â±ûÊÄß (Nearby Diff)</label><input type="number"
                                        id="p_self_diff" placeholder="0"></div>
                            </div>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="specialCond">
                            <span class="checkmark"></span>
                            Special Condition (Ëá≥ËøëË∑ùÈõ¢Á≠â)
                        </label>
                        <select id="specialCondValue" disabled>
                            <option value="1.1">1.1x</option>
                            <option value="1.2">1.2x</option>
                        </select>
                    </div>
                </section>
            </main>
            <footer style="text-align: center; padding: 2rem; color: var(--text-muted); font-size: 0.9rem;">
                <p>Created by @skd</p>
            </footer>
        </div> <!-- End content-wrapper -->
    </div> <!-- End app-container -->
    <script>
        // LV50 Technique Power Lookup Table
        const techniqueLookup = {
            "30": [115, 115, 115, 115, 115, 115],
            "50": [175, 192, 210, 227, 245, 262],
            "60": [210, 231, 252, 273, 294, 315],
            "70": [255, 280, 306, 331, 357, 382],
            "85": [312, 343, 374, 405, 436, 468],
            "100": [370, 407, 444, 481, 518, 555]
        };
        const dom = {
            presetContainer: document.getElementById('presetContainer'),
            manualContainer: document.getElementById('manualContainer'),
            calcKick: document.getElementById('calcKick'),
            calcControl: document.getElementById('calcControl'),
            kickManual: document.getElementById('kickManual'),
            controlManual: document.getElementById('controlManual'),
            basePower: document.getElementById('basePower'),
            evolution: document.getElementById('evolution'),
            multiplier: document.getElementById('multiplier'),
            charMatchup: document.getElementById('charMatchup'),
            techMatchup: document.getElementById('techMatchup'),
            specialCond: document.getElementById('specialCond'),
            specialCondValue: document.getElementById('specialCondValue'),
            kickBean: document.getElementById('kickBean'),
            controlBean: document.getElementById('controlBean'),
            equipBoots: document.getElementById('equipBoots'),
            equipBracelet: document.getElementById('equipBracelet'),
            equipPendant: document.getElementById('equipPendant'),
            equipSpecial: document.getElementById('equipSpecial'),
            presetCategory: document.getElementById('presetCategory'),
            presetsStandard: document.getElementById('presets-standard'),
            presetsBasara: document.getElementById('presets-basara'),
            presetsHero: document.getElementById('presets-hero'),
            techniquePowerDisplay: document.getElementById('techniquePowerDisplay'),
            characterPower: document.getElementById('characterPower'),
            totalAt: document.getElementById('totalAt')
        };
        let currentBaseKick = 121;
        let currentBaseControl = 115;
        let isManual = false;
        window.setPreset = function (k, c, el) {
            currentBaseKick = k;
            currentBaseControl = c;
            document.querySelectorAll('.btn-preset').forEach(btn => btn.classList.remove('active'));
            if (el) el.classList.add('active');
            calculate();
        };
        window.togglePresetCategory = function () {
            const cat = dom.presetCategory.value;
            dom.presetsStandard.classList.add('hidden');
            dom.presetsBasara.classList.add('hidden');
            dom.presetsHero.classList.add('hidden');
            if (cat === 'standard') dom.presetsStandard.classList.remove('hidden');
            else if (cat === 'basara') dom.presetsBasara.classList.remove('hidden');
            else if (cat === 'hero') dom.presetsHero.classList.remove('hidden');
        };
        window.setMaxBeans = function (type) {
            if (type === 'kick') dom.kickBean.value = 82;
            else if (type === 'control') dom.controlBean.value = 82;
            else if (type === 'all') { dom.kickBean.value = 82; dom.controlBean.value = 82; }
            calculate();
        };
        window.setClearBeans = function (type) {
            if (type === 'kick') dom.kickBean.value = 0;
            else if (type === 'control') dom.controlBean.value = 0;
            else if (type === 'all') { dom.kickBean.value = 0; dom.controlBean.value = 0; }
            calculate();
        };
        window.setMode = function (mode) {
            isManual = (mode === 'manual');
            document.getElementById('tab-preset').className = isManual ? 'tab-btn' : 'tab-btn active';
            document.getElementById('tab-manual').className = isManual ? 'tab-btn active' : 'tab-btn';
            if (isManual) {
                dom.presetContainer.classList.add('hidden');
                dom.manualContainer.classList.remove('hidden');
            } else {
                dom.presetContainer.classList.remove('hidden');
                dom.manualContainer.classList.add('hidden');
            }
            calculate();
        };
        window.setSegment = function (selectId, val, btn) {
            if (btn.classList.contains('disabled')) return;
            const select = document.getElementById(selectId);
            if (select) select.value = val;
            const container = btn.parentElement;
            container.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            calculate();
        };
        function showToast(message) {
            let toast = document.getElementById('toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'toast';
                document.body.appendChild(toast);
            }
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2000);
        }
        window.copyResults = function () {
            const text = `ina-vicaL (LV50):
Kick: ${dom.calcKick.textContent}
Ctrl: ${dom.calcControl.textContent}
Char Power: ${dom.characterPower.textContent}
Tech Power: ${dom.techniquePowerDisplay.textContent}
Total AT: ${dom.totalAt.textContent}`.trim();
            navigator.clipboard.writeText(text).then(() => { showToast("„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ"); });
        };
        function parseEquip(val) {
            if (!val) return { k: 0, c: 0 };
            const parts = val.split(',');
            return { k: parseFloat(parts[0]) || 0, c: parseFloat(parts[1]) || 0 };
        }
        let superMoveState = 'none';
        window.setSuperMove = function (mode, btn) {
            superMoveState = mode;
            const container = btn.parentElement;
            container.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const charBtn = document.getElementById('btnCharAdv');
            const techBtn = document.getElementById('btnTechAdv');
            if (mode === 'accel') {
                if (charBtn) charBtn.textContent = "ÊúâÂà© (2.0)‚òÖ";
                if (techBtn) techBtn.textContent = "ÊúâÂà© (2.0)‚òÖ";
            } else {
                if (charBtn) charBtn.textContent = "ÊúâÂà© (1.2)";
                if (techBtn) techBtn.textContent = "ÊúâÂà© (1.2)";
            }
            calculate();
        };
        function toggleMatchupLock(locked) {
            const techSelect = document.getElementById('techMatchup');
            if (techSelect) {
                let container = techSelect.parentElement.querySelector('.segmented-control');
                if (container) {
                    const buttons = container.querySelectorAll('.segment-btn');
                    if (locked) {
                        techSelect.value = '1.0';
                        buttons.forEach(b => {
                            if (b.getAttribute('onclick').includes("'1.0'")) {
                                b.classList.add('active'); b.classList.remove('disabled');
                            } else {
                                b.classList.remove('active'); b.classList.add('disabled');
                            }
                        });
                    } else {
                        buttons.forEach(b => b.classList.remove('disabled'));
                    }
                }
            }
            const charSelect = document.getElementById('charMatchup');
            if (charSelect) {
                let container = charSelect.parentElement.querySelector('.segmented-control');
                if (container) container.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('disabled'));
            }
        }
        let manualBonus = 0;
        window.togglePassives = function () {
            const el = document.getElementById('passiveContainer');
            const btn = document.getElementById('btnTogglePassive');
            if (el.style.display === 'none') {
                el.style.display = 'block'; btn.textContent = 'Passives ‚ñ≤';
            } else {
                el.style.display = 'none'; btn.textContent = 'Passives ‚ñº';
            }
        };
        window.handleManualInput = function (val) {
            const total = parseFloat(val) || 0;
            manualBonus = total - getPassiveSum();
            calculate();
        };
        window.updateFromPassive = function () {
            const total = manualBonus + getPassiveSum();
            if (dom.multiplier) dom.multiplier.value = total;
            calculate();
        };
        window.addManualBonus = function (amount) {
            manualBonus += amount;
            if (dom.multiplier) dom.multiplier.value = manualBonus + getPassiveSum();
            calculate();
        };
        window.clearBonuses = function () {
            manualBonus = 0;
            document.querySelectorAll('.passive-grid input').forEach(i => i.value = '');
            if (dom.multiplier) dom.multiplier.value = 0;
            calculate();
        };
        function getPassiveSum() {
            let sum = 0;
            document.querySelectorAll('.passive-grid input').forEach(i => {
                let val = parseFloat(i.value) || 0;
                sum += Math.min(100, Math.max(0, val));
            });
            return sum;
        }
        function calculate() {
            try {
                if (dom.basePower && dom.evolution) {
                    const is30 = (dom.basePower.value === '30');
                    toggleMatchupLock(is30);
                    const evoContainer = dom.evolution.parentElement.querySelector('.segmented-control');
                    if (evoContainer) {
                        const btns = evoContainer.querySelectorAll('.segment-btn');
                        if (is30) {
                            if (dom.evolution.value !== '1') {
                                dom.evolution.value = '1';
                                btns.forEach(b => b.classList.remove('active'));
                                if (btns[0]) btns[0].classList.add('active');
                            }
                            btns.forEach((b, i) => { if (i > 0) b.classList.add('disabled'); });
                        } else {
                            btns.forEach(b => b.classList.remove('disabled'));
                        }
                    }
                }
                let kickEff = 0, controlEff = 0;
                if (isManual) {
                    kickEff = parseFloat(dom.kickManual.value) || 0;
                    controlEff = parseFloat(dom.controlManual.value) || 0;
                } else {
                    const cat = dom.presetCategory.value;
                    let rarityMult = (cat === 'standard') ? 1.4 : 1.0;
                    const totalEquipKick = parseEquip(dom.equipBoots.value).k + parseEquip(dom.equipBracelet.value).k + parseEquip(dom.equipPendant.value).k + parseEquip(dom.equipSpecial.value).k;
                    const totalEquipCtrl = parseEquip(dom.equipBoots.value).c + parseEquip(dom.equipBracelet.value).c + parseEquip(dom.equipPendant.value).c + parseEquip(dom.equipSpecial.value).c;
                    kickEff = Math.floor(currentBaseKick * rarityMult) + (parseFloat(dom.kickBean.value) || 0) + totalEquipKick;
                    controlEff = Math.floor(currentBaseControl * rarityMult) + (parseFloat(dom.controlBean.value) || 0) + totalEquipCtrl;
                }
                dom.calcKick.textContent = kickEff; dom.calcControl.textContent = controlEff;
                let charMult = parseFloat(dom.charMatchup.value);
                if (superMoveState === 'accel' && charMult === 1.2) charMult = 2.0;
                const charPowerBase = (kickEff + controlEff) * charMult;
                let bonus = parseFloat(dom.multiplier.value) || 0;
                if (superMoveState === 'od') bonus += 50;
                if (superMoveState === 'keshin') bonus += 40;
                if (superMoveState === 'armed') bonus += 20;
                if (superMoveState === 'accel') bonus += 30;
                if (superMoveState === 'boost30') bonus += 30;
                let totalMult = (1 + bonus / 100) * (dom.specialCond.checked ? (parseFloat(dom.specialCondValue.value) || 1.0) : 1.0);
                dom.characterPower.textContent = Math.floor(charPowerBase * totalMult);
                const base = dom.basePower.value;
                const evo = dom.evolution.value;
                let techPower = techniqueLookup[base][parseInt(evo) - 1];
                if (superMoveState === 'armed') techPower *= 1.3;
                let techMatchMult = parseFloat(dom.techMatchup.value);
                if (superMoveState === 'accel' && techMatchMult === 1.2) techMatchMult = 2.0;
                techPower = Math.floor(techPower * techMatchMult);
                dom.techniquePowerDisplay.textContent = techPower;
                dom.totalAt.textContent = Math.floor((charPowerBase + techPower) * totalMult);
            } catch (e) { console.error(e); }
        }
        const inputs = [dom.basePower, dom.evolution, dom.multiplier, dom.charMatchup, dom.techMatchup, dom.specialCond, dom.specialCondValue, dom.kickBean, dom.controlBean, dom.equipBoots, dom.equipBracelet, dom.equipPendant, dom.equipSpecial, dom.kickManual, dom.controlManual, dom.presetCategory];
        inputs.forEach(input => { input.addEventListener('input', calculate); input.addEventListener('change', calculate); });
        dom.specialCond.addEventListener('change', () => { dom.specialCondValue.disabled = !dom.specialCond.checked; calculate(); });
        document.querySelectorAll('.passive-grid input').forEach(input => {
            input.min = 0; input.max = 100;
            input.addEventListener('input', updateFromPassive);
            input.addEventListener('change', function () {
                let v = parseFloat(this.value) || 0;
                if (v < 0) { v = 0; this.value = 0; }
                if (v > 100) { v = 100; this.value = 100; }
                updateFromPassive();
            });
        });
        setMode('preset');
    </script>
</body>
</html>
